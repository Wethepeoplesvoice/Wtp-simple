
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>We The People's Voice â€“ Grassroots Civic Web App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Basic open graph (for social sharing later) -->
  <meta property="og:title" content="We The People's Voice">
  <meta property="og:description" content="Grassroots civic platform where Americans draft issues, vote, and practice building real mandates for change.">
  <meta property="og:type" content="website">

  <style>
    :root {
      --bg: #020617;
      --bg-soft: #02081f;
      --card: #02081f;
      --card-soft: #020b2b;
      --accent: #22c55e;
      --accent-soft: rgba(34, 197, 94, 0.15);
      --accent-strong: #4ade80;
      --text-main: #e5e7eb;
      --text-muted: #9ca3af;
      --danger: #ef4444;
      --border-subtle: #111827;
      --shadow-soft: 0 18px 45px rgba(0, 0, 0, 0.75);
      --radius-lg: 22px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        Inter, Roboto, sans-serif;
      background: radial-gradient(circle at top, #020617 0%, #020013 45%, #020617 100%);
      color: var(--text-main);
      -webkit-font-smoothing: antialiased;
      padding: 20px 12px 28px;
    }

    @media (min-width: 768px) {
      body {
        padding: 28px 28px 40px;
      }
    }

    .app-shell {
      max-width: 1040px;
      margin: 0 auto;
      background: radial-gradient(circle at top left, #020b2b, #020617 55%);
      border-radius: 30px;
      border: 1px solid #020b2b;
      box-shadow: var(--shadow-soft);
      overflow: hidden;
    }

    header {
      padding: 22px 18px 14px;
      border-bottom: 1px solid rgba(15, 23, 42, 0.9);
      background: radial-gradient(circle at top left, rgba(37, 99, 235, 0.2), transparent 70%);
    }

    @media (min-width: 768px) {
      header {
        padding: 26px 26px 16px;
      }
    }

    .header-top {
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      align-items: center;
      gap: 10px;
      margin-bottom: 12px;
    }

    .badge-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
    }

    .badge {
      font-size: 11px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      padding: 4px 10px;
      border-radius: 999px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      background: linear-gradient(to right, #020617, #02081f);
      color: var(--text-muted);
    }

    .badge-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: radial-gradient(circle, #22c55e 10%, #4ade80 55%, #166534 100%);
      box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.2);
    }

    .badge-cta {
      background: linear-gradient(135deg, #22c55e, #16a34a);
      border: none;
      color: #022c22;
      font-weight: 600;
      box-shadow: 0 0 0 1px rgba(22, 163, 74, 0.25), 0 14px 32px rgba(16, 185, 129, 0.65);
    }

    .header-title-block h1 {
      margin: 0;
      font-size: 26px;
      line-height: 1.1;
      letter-spacing: 0.08em;
    }

    @media (min-width: 768px) {
      .header-title-block h1 {
        font-size: 32px;
      }
    }

    .header-sub {
      margin: 4px 0 0;
      font-size: 13px;
      color: var(--text-muted);
      max-width: 640px;
    }

    .header-sub strong {
      color: #e5e7eb;
      font-weight: 600;
    }

    main {
      padding: 14px 14px 20px;
    }

    @media (min-width: 768px) {
      main {
        padding: 18px 22px 24px;
      }
    }

    .layout-grid {
      display: grid;
      gap: 16px;
    }

    @media (min-width: 960px) {
      .layout-grid {
        grid-template-columns: minmax(0, 1.05fr) minmax(0, 1fr);
        align-items: flex-start;
      }
    }

    .card {
      background: radial-gradient(circle at top left, #020b2b, #020617 70%);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-subtle);
      padding: 16px 14px 16px;
      box-shadow: 0 14px 30px rgba(15, 23, 42, 0.85);
    }

    @media (min-width: 768px) {
      .card {
        padding: 18px 18px 18px;
      }
    }

    .card-header-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 10px;
    }

    .card-title {
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--text-muted);
    }

    .card-subtitle {
      font-size: 12px;
      color: var(--text-muted);
      margin-top: 3px;
    }

    .btn-secondary,
    .btn-primary {
      border-radius: 999px;
      border: 1px solid #1e293b;
      background: #020617;
      color: var(--text-muted);
      font-size: 12px;
      padding: 7px 12px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .btn-secondary:hover {
      border-color: #4b5563;
      color: #e5e7eb;
    }

    .btn-primary {
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: #022c22;
      font-weight: 600;
      border-color: #16a34a;
      box-shadow: 0 16px 40px rgba(16, 185, 129, 0.65);
      justify-content: center;
    }

    .btn-primary:hover {
      filter: brightness(1.05);
    }

    /* VOTER STATUS */
    .voter-card {
      margin-bottom: 14px;
      border-radius: 18px;
      background: radial-gradient(circle at top left, rgba(34, 197, 94, 0.18), #020617 70%);
      border: 1px solid rgba(34, 197, 94, 0.3);
      padding: 12px 12px 10px;
    }

    .voter-top-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
    }

    .voter-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--text-muted);
    }

    .voter-badge {
      font-size: 11px;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(248, 113, 113, 0.7);
      background: radial-gradient(circle at top left, rgba(248, 113, 113, 0.18), #020617 70%);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      color: #fecaca;
    }

    .voter-badge-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: radial-gradient(circle, #f97373 20%, #b91c1c 80%);
      box-shadow: 0 0 0 4px rgba(239, 68, 68, 0.28);
    }

    .voter-badge.verified {
      border-color: rgba(34, 197, 94, 0.7);
      background: radial-gradient(circle at top left, rgba(34, 197, 94, 0.2), #020617 70%);
      color: #bbf7d0;
    }

    .voter-badge.verified .voter-badge-dot {
      background: radial-gradient(circle, #22c55e 20%, #15803d 85%);
      box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.28);
    }

    .voter-form-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      margin-bottom: 6px;
    }

    .voter-select {
      flex: 1 1 120px;
      min-width: 120px;
    }

    .voter-select select {
      width: 100%;
      padding: 6px 9px;
      border-radius: 999px;
      border: 1px solid #1e293b;
      background: #020617;
      color: var(--text-main);
      font-size: 12px;
    }

    .voter-checkbox {
      flex: 2 1 180px;
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
      color: var(--text-muted);
    }

    .voter-checkbox input {
      accent-color: #22c55e;
    }

    .voter-save-btn {
      flex: 0 0 auto;
      font-size: 11px;
      padding: 6px 10px;
      border-radius: 999px;
      border: none;
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: #022c22;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 10px 24px rgba(16, 185, 129, 0.55);
    }

    .voter-note {
      font-size: 10px;
      color: var(--text-muted);
    }

    /* FORM */
    .modern-form {
      display: flex;
      flex-direction: column;
      gap: 20px;
      margin-top: 10px;
    }

    .form-group {
      position: relative;
      margin-top: 8px;
    }

    .floating-label {
      position: absolute;
      top: -10px;
      left: 12px;
      background: var(--card);
      padding: 0 6px;
      font-size: 12px;
      color: var(--text-muted);
    }

    .modern-input {
      width: 100%;
      padding: 12px;
      border-radius: 10px;
      border: 1px solid var(--border-subtle);
      background: var(--card-soft);
      color: var(--text-main);
      font-size: 14px;
      transition: 0.16s;
    }

    .modern-input:focus {
      outline: 2px solid var(--accent);
      border-color: var(--accent);
    }

    textarea.modern-input {
      resize: vertical;
      min-height: 110px;
      line-height: 1.4;
    }

    .char-count {
      text-align: right;
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 3px;
    }

    .tag-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 6px;
    }

    .tag-btn {
      padding: 7px 12px;
      border-radius: 999px;
      border: 1px solid #1f2937;
      font-size: 11px;
      background: #020617;
      color: var(--text-muted);
      cursor: pointer;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .tag-btn.active {
      background: var(--accent);
      color: #022c22;
      border-color: var(--accent-strong);
    }

    .submit-wrap {
      margin-top: 4px;
    }

    .btn-full {
      width: 100%;
      padding: 11px 12px;
      font-size: 15px;
    }

    .form-hint {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 3px;
    }

    /* ISSUES + STATS */
    .issues-layout {
      display: grid;
      gap: 10px;
    }

    @media (min-width: 840px) {
      .issues-layout {
        grid-template-columns: minmax(0, 1.35fr) minmax(0, 0.95fr);
      }
    }

    .filter-row {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 11px;
      color: var(--text-muted);
      margin-bottom: 6px;
    }

    .filter-row select {
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid #1e293b;
      background: #020617;
      color: var(--text-main);
    }

    .issues-empty {
      font-size: 12px;
      color: var(--text-muted);
      border-radius: 14px;
      border: 1px dashed #1f2937;
      padding: 8px 9px;
      background: radial-gradient(circle at top left, #020b2b, #020617 70%);
      margin-top: 6px;
    }

    .issues-list {
      margin-top: 6px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .issue-card {
      border-radius: 16px;
      border: 1px solid #111827;
      background: radial-gradient(circle at top left, #020b2b, #020617 70%);
      padding: 8px 8px 9px;
      display: grid;
      grid-template-columns: auto minmax(0, 1fr);
      gap: 8px;
    }

    .issue-vote-col {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 4px;
      min-width: 32px;
    }

    .vote-btn {
      width: 22px;
      height: 22px;
      border-radius: 999px;
      border: 1px solid #1f2937;
      background: #020617;
      color: var(--text-muted);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      cursor: pointer;
    }

    .vote-btn:hover {
      border-color: #4b5563;
      color: #e5e7eb;
    }

    .vote-count {
      font-size: 13px;
      font-weight: 600;
    }

    .issue-main {
      min-width: 0;
    }

    .issue-title-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 3px;
    }

    .issue-title {
      font-size: 13px;
      font-weight: 600;
    }

    .issue-scope {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      padding: 3px 7px;
      border-radius: 999px;
      border: 1px solid #1f2937;
      background: #020617;
      color: var(--text-muted);
    }

    .issue-meta {
      font-size: 11px;
      color: var(--text-muted);
      margin-bottom: 3px;
    }

    .issue-body {
      font-size: 12px;
      color: #d1d5db;
      margin-bottom: 3px;
    }

    .issue-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
      margin-top: 3px;
    }

    .issue-tag-pill {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      padding: 3px 7px;
      border-radius: 999px;
      border: 1px solid #1f2937;
      background: #020617;
      color: #9ca3af;
    }

    .stats-box {
      border-radius: 16px;
      border: 1px solid #111827;
      background: radial-gradient(circle at top left, #020b2b, #020617 70%);
      padding: 10px 10px 10px;
      font-size: 12px;
      color: var(--text-muted);
    }

    .stats-box h3 {
      margin: 0 0 4px;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: #9ca3af;
    }

    .stat-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 4px;
      font-size: 12px;
    }

    .stat-row strong {
      color: #e5e7eb;
      font-weight: 500;
    }

    footer {
      padding: 8px 16px 14px;
      border-top: 1px solid #02081f;
      font-size: 11px;
      color: var(--text-muted);
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 4px;
      background: radial-gradient(circle at bottom right, rgba(37, 99, 235, 0.25), transparent 60%);
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <header>
      <div class="header-top">
        <div class="badge-row">
          <div class="badge">
            <span class="badge-dot"></span>
            LIVE GRASSROOTS PROTOTYPE
          </div>
          <div class="badge badge-cta">
            WE THE PEOPLE'S VOICE
          </div>
        </div>
      </div>
      <div class="header-title-block">
        <h1>WE THE PEOPLE'S VOICE</h1>
        <p class="header-sub">
          A grassroots civic tool where <strong>everyday Americans</strong> can draft clear one-page issues,
          see how people vote, and practice turning support into real mandates. When enough of us stand together,
          it becomes a <strong>mandate leaders can't ignore</strong>.
        </p>
      </div>
    </header>

    <main>
      <div class="layout-grid">
        <!-- LEFT SIDE: VOTER + FORM -->
        <section>
          <!-- VOTER STATUS (LOCAL DEMO) -->
          <div class="voter-card">
            <div class="voter-top-row">
              <div class="voter-label">Your voter status (local demo)</div>
              <div id="voterBadge" class="voter-badge">
                <span id="voterDot" class="voter-badge-dot"></span>
                <span id="voterText">Not verified</span>
              </div>
            </div>

            <div class="voter-form-row">
              <div class="voter-select">
                <select id="voterState">
                  <option value="">Your state</option>
                  <option value="AL">Alabama</option>
                  <option value="AK">Alaska</option>
                  <option value="AZ">Arizona</option>
                  <option value="AR">Arkansas</option>
                  <option value="CA">California</option>
                  <option value="CO">Colorado</option>
                  <option value="CT">Connecticut</option>
                  <option value="DE">Delaware</option>
                  <option value="FL">Florida</option>
                  <option value="GA">Georgia</option>
                  <option value="HI">Hawaii</option>
                  <option value="ID">Idaho</option>
                  <option value="IL">Illinois</option>
                  <option value="IN">Indiana</option>
                  <option value="IA">Iowa</option>
                  <option value="KS">Kansas</option>
                  <option value="KY">Kentucky</option>
                  <option value="LA">Louisiana</option>
                  <option value="ME">Maine</option>
                  <option value="MD">Maryland</option>
                  <option value="MA">Massachusetts</option>
                  <option value="MI">Michigan</option>
                  <option value="MN">Minnesota</option>
                  <option value="MS">Mississippi</option>
                  <option value="MO">Missouri</option>
                  <option value="MT">Montana</option>
                  <option value="NE">Nebraska</option>
                  <option value="NV">Nevada</option>
                  <option value="NH">New Hampshire</option>
                  <option value="NJ">New Jersey</option>
                  <option value="NM">New Mexico</option>
                  <option value="NY">New York</option>
                  <option value="NC">North Carolina</option>
                  <option value="ND">North Dakota</option>
                  <option value="OH">Ohio</option>
                  <option value="OK">Oklahoma</option>
                  <option value="OR">Oregon</option>
                  <option value="PA">Pennsylvania</option>
                  <option value="RI">Rhode Island</option>
                  <option value="SC">South Carolina</option>
                  <option value="SD">South Dakota</option>
                  <option value="TN">Tennessee</option>
                  <option value="TX">Texas</option>
                  <option value="UT">Utah</option>
                  <option value="VT">Vermont</option>
                  <option value="VA">Virginia</option>
                  <option value="WA">Washington</option>
                  <option value="WV">West Virginia</option>
                  <option value="WI">Wisconsin</option>
                  <option value="WY">Wyoming</option>
                  <option value="DC">District of Columbia</option>
                </select>
              </div>
              <label class="voter-checkbox">
                <input type="checkbox" id="voterCitizen">
                I am a U.S. citizen and at least 18 years old.
              </label>
              <button class="voter-save-btn" id="saveVoterBtn">Save</button>
            </div>

            <div class="voter-note">
              This is a <strong>demo only</strong>. Your voter status is saved in this browser and not linked to your real identity yet.
              In a future, verified version, this would connect to secure accounts, ID checks, and real vote thresholds.
            </div>
          </div>

          <!-- CREATE ISSUE FORM -->
          <section class="card">
            <div class="card-header-row">
              <div>
                <div class="card-title">Create a new issue to vote on</div>
                <div class="card-subtitle">
                  One subject. One page. Draft it clearly so any American can understand and vote.
                </div>
              </div>
              <button class="btn-secondary" id="loadExampleBtn">ðŸ“„ Load term-limits example</button>
            </div>

            <form id="issueForm" class="modern-form">
              <div class="form-group">
                <label class="floating-label" for="issueTitle">Issue title *</label>
                <input
                  id="issueTitle"
                  type="text"
                  maxlength="120"
                  class="modern-input"
                  required
                >
                <div class="char-count">
                  <span id="titleCount">0</span>/120
                </div>
              </div>

              <div class="form-group">
                <label class="floating-label" for="scopeInput">Where does this apply? *</label>
                <select id="scopeInput" class="modern-input" required>
                  <option value="National">National (U.S.-wide)</option>
                  <option value="State">State-level</option>
                  <option value="Local">Local / City / County</option>
                </select>
              </div>

              <div class="form-group">
                <label class="floating-label">How should this be categorized?</label>
                <div class="tag-grid" id="tagOptions">
                  <button type="button" class="tag-btn">No party labels</button>
                  <button type="button" class="tag-btn">Checks & balances</button>
                  <button type="button" class="tag-btn">Anti-corruption</button>
                  <button type="button" class="tag-btn">Article V style</button>
                  <button type="button" class="tag-btn">Election reform</button>
                  <button type="button" class="tag-btn">Fiscal responsibility</button>
                </div>
                <input type="hidden" id="selectedTags">
              </div>

              <div class="form-group">
                <label class="floating-label" for="issueDescription">
                  What action do you want Congress or your state to take? *
                </label>
                <textarea
                  id="issueDescription"
                  class="modern-input"
                  maxlength="1200"
                  required
                ></textarea>
                <div class="char-count">
                  <span id="descCount">0</span>/1200
                </div>
                <div class="form-hint">
                  Write this like a simple one-page bill in plain English. One subject, one clear solution.
                </div>
              </div>

              <div class="form-group">
                <label class="floating-label" for="extraTags">Optional tags / key points</label>
                <input
                  id="extraTags"
                  type="text"
                  class="modern-input"
                  placeholder="term limits, shutdown rules, no lifetime benefits"
                >
              </div>

              <div class="submit-wrap">
                <button type="submit" class="btn-primary btn-full">
                  âž• Publish issue for voting (local test)
                </button>
              </div>
            </form>
          </section>
        </section>

        <!-- RIGHT SIDE: ISSUES & STATS -->
        <section class="card">
          <div class="card-header-row">
            <div>
              <div class="card-title">Live issues & votes (on this device)</div>
              <div class="card-subtitle">
                See the questions you've drafted and practice voting them up or down.
              </div>
            </div>
            <button class="btn-secondary" id="clearIssuesBtn">ðŸ§¹ Clear all issues</button>
          </div>

          <div class="issues-layout">
            <div>
              <div class="filter-row">
                <span>Showing:</span>
                <select id="scopeFilter">
                  <option value="All">All â€“ national & local</option>
                  <option value="National">National only</option>
                  <option value="State">State-level</option>
                  <option value="Local">Local issues</option>
                </select>
              </div>

              <div id="issuesEmpty" class="issues-empty">
                No issues yet. Use the form on the left to create the first one-page idea.
              </div>

              <div id="issuesList" class="issues-list"></div>
            </div>

            <div class="stats-box">
              <h3>Support stats (local demo)</h3>
              <p>
                These numbers are calculated only on this device. A future verified version will track support across
                the country and, once enough votes are reached, <strong>prepare formal petitions</strong> for Congress
                and your state representatives.
              </p>
              <div class="stat-row">
                <strong>Total issues:</strong>
                <span id="statTotalIssues">0</span>
              </div>
              <div class="stat-row">
                <strong>Highest support:</strong>
                <span id="statTopSupport">0%</span>
              </div>
              <div class="stat-row">
                <strong>Most supported issue:</strong>
                <span id="statTopIssue">None yet</span>
              </div>
            </div>
          </div>
        </section>
      </div>
    </main>

    <footer>
      <div>Â© <span id="yearSpan"></span> We The People's Voice â€“ Grassroots Civic Prototype</div>
      <div>Future: verified U.S. voters â€¢ real petitions â€¢ Congress & state-level action</div>
    </footer>
  </div>

  <script>
    // === HELPER ===
    function $(id) {
      return document.getElementById(id);
    }

    // === VOTER STATUS (LOCAL DEMO) ===
    function updateVoterBadge() {
      const state = localStorage.getItem("wtp_voter_state");
      const citizen = localStorage.getItem("wtp_voter_citizen") === "true";
      const badge = $("voterBadge");
      const text = $("voterText");

      if (state && citizen) {
        badge.classList.add("verified");
        text.textContent = "Verified (local demo)";
      } else {
        badge.classList.remove("verified");
        text.textContent = "Not verified";
      }
    }

    $("saveVoterBtn").addEventListener("click", () => {
      const state = $("voterState").value;
      const citizen = $("voterCitizen").checked;
      localStorage.setItem("wtp_voter_state", state || "");
      localStorage.setItem("wtp_voter_citizen", citizen ? "true" : "false");
      updateVoterBadge();
      alert("Voter status saved (demo only, on this device).");
    });

    // Load voter data on startup
    (function initVoter() {
      const savedState = localStorage.getItem("wtp_voter_state") || "";
      const savedCitizen = localStorage.getItem("wtp_voter_citizen") === "true";
      if (savedState) $("voterState").value = savedState;
      $("voterCitizen").checked = savedCitizen;
      updateVoterBadge();
    })();

    // === ISSUES STORAGE ===
    let issues = [];

    function saveIssues() {
      localStorage.setItem("wtp_issues_v1", JSON.stringify(issues));
    }

    function loadIssues() {
      const raw = localStorage.getItem("wtp_issues_v1");
      if (!raw) {
        issues = [];
      } else {
        try {
          issues = JSON.parse(raw) || [];
        } catch (e) {
          issues = [];
        }
      }
    }

    // === RENDER ISSUES + STATS ===
    function renderIssues() {
      const listEl = $("issuesList");
      const emptyEl = $("issuesEmpty");
      const scopeFilter = $("scopeFilter").value;

      listEl.innerHTML = "";

      const filtered = issues.filter(issue => {
        if (scopeFilter === "All") return true;
        return issue.scope === scopeFilter;
      });

      if (filtered.length === 0) {
        emptyEl.style.display = "block";
      } else {
        emptyEl.style.display = "none";
      }

      filtered.forEach(issue => {
        const up = issue.up || 0;
        const down = issue.down || 0;
        const total = up + down;
        const supportPct = total > 0 ? Math.round((up / total) * 100) : 0;

        const card = document.createElement("div");
        card.className = "issue-card";

        const voteCol = document.createElement("div");
        voteCol.className = "issue-vote-col";

        const upBtn = document.createElement("button");
        upBtn.className = "vote-btn";
        upBtn.textContent = "â–²";
        upBtn.onclick = () => {
          issue.up = (issue.up || 0) + 1;
          saveIssues();
          renderIssues();
        };

        const downBtn = document.createElement("button");
        downBtn.className = "vote-btn";
        downBtn.textContent = "â–¼";
        downBtn.onclick = () => {
          issue.down = (issue.down || 0) + 1;
          saveIssues();
          renderIssues();
        };

        const countSpan = document.createElement("div");
        countSpan.className = "vote-count";
        countSpan.textContent = supportPct + "%";

        voteCol.appendChild(upBtn);
        voteCol.appendChild(countSpan);
        voteCol.appendChild(downBtn);

        const mainCol = document.createElement("div");
        mainCol.className = "issue-main";

        const titleRow = document.createElement("div");
        titleRow.className = "issue-title-row";

        const title = document.createElement("div");
        title.className = "issue-title";
        title.textContent = issue.title;

        const scopeEl = document.createElement("div");
        scopeEl.className = "issue-scope";
        scopeEl.textContent = issue.scope;

        titleRow.appendChild(title);
        titleRow.appendChild(scopeEl);

        const meta = document.createElement("div");
        meta.className = "issue-meta";
        const date = new Date(issue.createdAt || Date.now());
        meta.textContent = "Support: " + supportPct + "% â€¢ Created " + date.toLocaleDateString();

        const body = document.createElement("div");
        body.className = "issue-body";
        body.textContent = issue.description;

        const tagsRow = document.createElement("div");
        tagsRow.className = "issue-tags";

        (issue.tags || []).forEach(tag => {
          const span = document.createElement("span");
          span.className = "issue-tag-pill";
          span.textContent = tag;
          tagsRow.appendChild(span);
        });

        if (issue.extraTags) {
          issue.extraTags.split(",").map(s => s.trim()).filter(Boolean).forEach(tag => {
            const span = document.createElement("span");
            span.className = "issue-tag-pill";
            span.textContent = tag;
            tagsRow.appendChild(span);
          });
        }

        mainCol.appendChild(titleRow);
        mainCol.appendChild(meta);
        mainCol.appendChild(body);
        if (tagsRow.children.length > 0) {
          mainCol.appendChild(tagsRow);
        }

        card.appendChild(voteCol);
        card.appendChild(mainCol);
        listEl.appendChild(card);
      });

      // Stats
      const totalIssues = issues.length;
      $("statTotalIssues").textContent = totalIssues;

      if (totalIssues === 0) {
        $("statTopSupport").textContent = "0%";
        $("statTopIssue").textContent = "None yet";
      } else {
        let topIssue = null;
        let topSupport = -1;
        issues.forEach(issue => {
          const up = issue.up || 0;
          const down = issue.down || 0;
          const total = up + down;
          const pct = total > 0 ? (up / total) * 100 : 0;
          if (pct > topSupport) {
            topSupport = pct;
            topIssue = issue;
          }
        });
        $("statTopSupport").textContent = Math.round(topSupport) + "%";
        $("statTopIssue").textContent = topIssue ? topIssue.title : "None yet";
      }
    }

    // === FORM HANDLERS ===
    const titleInput = $("issueTitle");
    const descInput = $("issueDescription");

    titleInput.addEventListener("input", () => {
      $("titleCount").textContent = titleInput.value.length;
    });

    descInput.addEventListener("input", () => {
      $("descCount").textContent = descInput.value.length;
    });

    // Tag buttons
    const tagButtons = document.querySelectorAll(".tag-btn");
    const selectedTagsInput = $("selectedTags");
    let selectedTags = [];

    tagButtons.forEach(btn => {
      btn.addEventListener("click", () => {
        const tag = btn.textContent;
        if (btn.classList.contains("active")) {
          btn.classList.remove("active");
          selectedTags = selectedTags.filter(t => t !== tag);
        } else {
          if (selectedTags.length < 3) {
            btn.classList.add("active");
            selectedTags.push(tag);
          }
        }
        selectedTagsInput.value = selectedTags.join(",");
      });
    });

    $("issueForm").addEventListener("submit", (e) => {
      e.preventDefault();

      const title = titleInput.value.trim();
      const scope = $("scopeInput").value;
      const description = descInput.value.trim();
      const extraTags = $("extraTags").value.trim();
      const tags = selectedTagsInput.value
        ? selectedTagsInput.value.split(",").map(s => s.trim()).filter(Boolean)
        : [];

      if (!title || !description) {
        alert("Please fill in the required fields: title and description.");
        return;
      }

      const issue = {
        id: Date.now(),
        title,
        scope,
        description,
        tags,
        extraTags,
        up: 0,
        down: 0,
        createdAt: Date.now()
      };

      issues.unshift(issue);
      saveIssues();
      renderIssues();

      // Reset form
      e.target.reset();
      selectedTags = [];
      selectedTagsInput.value = "";
      tagButtons.forEach(btn => btn.classList.remove("active"));
      $("titleCount").textContent = "0";
      $("descCount").textContent = "0";

      alert("Issue published (local test). Scroll to the right side to see it.");
    });

    // Example loader
    $("loadExampleBtn").addEventListener("click", () => {
      titleInput.value = "Should Congress have 12-year total term limits?";
      $("titleCount").textContent = titleInput.value.length;

      $("scopeInput").value = "National";
      descInput.value =
        "Proposal: Amend federal law so that no individual may serve more than a total of twelve (12) years in the U.S. Congress, " +
        "combining service in the House and the Senate. Existing members may finish their current term and then are subject to the same cap. " +
        "Congress shall not increase its own benefits as a result of this change, and future pay or benefits must be approved by a separate, " +
        "single-subject public vote.";
      $("descCount").textContent = descInput.value.length;

      $("extraTags").value = "term limits, corruption, accountability";

      // Reset tag buttons then activate some
      selectedTags = [];
      tagButtons.forEach(btn => btn.classList.remove("active"));
      ["No party labels", "Anti-corruption", "Checks & balances"].forEach(label => {
        tagButtons.forEach(btn => {
          if (btn.textContent === label && selectedTags.length < 3) {
            btn.classList.add("active");
            selectedTags.push(label);
          }
        });
      });
      selectedTagsInput.value = selectedTags.join(",");
    });

    // Clear issues
    $("clearIssuesBtn").addEventListener("click", () => {
      if (!confirm("Clear all issues from this device?")) return;
      issues = [];
      saveIssues();
      renderIssues();
    });

    // Init issues + footer year
    loadIssues();
    renderIssues();
    $("yearSpan").textContent = new Date().getFullYear();
  </script>
</body>
</html>
